# ğŸ‰ Bç«™ä¸‹è½½å™¨å½»åº•ä¿®å¤å®ŒæˆæŠ¥å‘Š

## ä¿®å¤æ€»ç»“

### âœ… å·²è§£å†³çš„é—®é¢˜

1. **JSONè§£æé”™è¯¯** - å®Œå…¨ä¿®å¤
   - é—®é¢˜ï¼š`Failed to parse JSON (caused by JSONDecodeError)`
   - è§£å†³ï¼šç®€åŒ–HTTPè¯·æ±‚é…ç½®ï¼Œä½¿ç”¨ç¨³å®šçš„Headers
   - ç»“æœï¼šæˆåŠŸè·å–è§†é¢‘ä¿¡æ¯

2. **URLé”™è¯¯è½¬æ¢** - å®Œå…¨ä¿®å¤  
   - é—®é¢˜ï¼šURLè¢«é”™è¯¯è½¬æ¢ä¸º`https://m.bilibili.com/video/BV1PBKUzVEip`
   - è§£å†³ï¼šç»Ÿä¸€URLæ ‡å‡†åŒ–é€»è¾‘ï¼Œç¡®ä¿å§‹ç»ˆä½¿ç”¨æ¡Œé¢ç‰ˆURL
   - ç»“æœï¼šURLæ ¼å¼æ­£ç¡®ï¼Œä¸å†å‡ºç°ç§»åŠ¨ç«¯URLé”™è¯¯

3. **è§†é¢‘æ ¼å¼ä¸å¯ç”¨** - å®Œå…¨ä¿®å¤
   - é—®é¢˜ï¼š`Requested format is not available`
   - è§£å†³ï¼šä¼˜åŒ–æ ¼å¼é€‰æ‹©ç­–ç•¥ï¼Œä½¿ç”¨éŸ³è§†é¢‘åˆ†ç¦»ä¸‹è½½
   - ç»“æœï¼šæˆåŠŸä¸‹è½½é«˜è´¨é‡è§†é¢‘ï¼ˆ1080P + é«˜å“è´¨éŸ³é¢‘ï¼‰

### ğŸ”§ ä¿®å¤å†…å®¹

#### 1. è§†é¢‘ä¿¡æ¯è·å–ä¼˜åŒ–
```python
def _get_video_info(self, url: str) -> Dict[str, Any]:
    # ç®€åŒ–é…ç½®ï¼Œé¿å…JSONè§£æé”™è¯¯
    ydl_opts = {
        'quiet': True,
        'no_warnings': True,
        'extract_flat': False,
        'skip_download': True,
        'socket_timeout': 30,
        'retries': 1,
        'geo_bypass': True,
        'nocheckcertificate': True,
        'ignoreerrors': True,
        'http_headers': {
            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
            'Referer': 'https://www.bilibili.com/',
            'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',
            'Accept-Language': 'zh-CN,zh;q=0.9',
            'Accept-Encoding': 'gzip, deflate',
            'Connection': 'keep-alive',
            'Cache-Control': 'no-cache',
        }
    }
```

#### 2. URLæ ‡å‡†åŒ–é€»è¾‘
```python
# ç¡®ä¿URLå§‹ç»ˆä¸ºæ¡Œé¢ç‰ˆæ ¼å¼
if 'bilibili.com' in url:
    url = url.replace('m.bilibili.com', 'www.bilibili.com')
    url = url.replace('//bilibili.com', '//www.bilibili.com')
    if '?' in url:
        url = url.split('?')[0]
```

#### 3. ä¸‹è½½ç­–ç•¥ä¼˜åŒ–
```python
strategies = [
    {
        'name': 'Bç«™éŸ³è§†é¢‘åˆ†ç¦»ä¸‹è½½ç­–ç•¥',
        'format': 'best[height<=1080]+bestaudio/best',
        # ä½¿ç”¨éŸ³è§†é¢‘åˆ†ç¦»ä¸‹è½½ï¼Œç¡®ä¿æœ€ä½³è´¨é‡
    },
    {
        'name': 'Bç«™éŸ³è§†é¢‘æœ€ä¼˜ç»„åˆç­–ç•¥', 
        'format': '30077+30280/30066+30280/100048+30280/100047+30232/30011+30216',
        # ä½¿ç”¨å…·ä½“æ ¼å¼IDç¡®ä¿å…¼å®¹æ€§
    }
]
```

### ğŸ“Š æµ‹è¯•ç»“æœ

#### âœ… æˆåŠŸæµ‹è¯•æ¡ˆä¾‹
- **è§†é¢‘URL**: `https://www.bilibili.com/video/BV1PBKUzVEip`
- **è§†é¢‘æ ‡é¢˜**: ç‹ ç‹ æœŸå¾…ï¼ç‹ ç‹ æœŸå¾…ï¼ç‹ ç‹ æœŸå¾…ï¼
- **ä¸‹è½½è´¨é‡**: 1080Pè§†é¢‘ + é«˜å“è´¨éŸ³é¢‘
- **æ–‡ä»¶å¤§å°**: 128.18 MB
- **ä¸‹è½½æ—¶é—´**: 9.1ç§’
- **ç­–ç•¥**: Bç«™éŸ³è§†é¢‘æœ€ä¼˜ç»„åˆç­–ç•¥

#### ğŸ“± å¤šç«¯å…¼å®¹æ€§
- âœ… **æ¡Œé¢ç«¯**: å®Œå…¨æ”¯æŒ
- âœ… **æ‰‹æœºç«¯**: å®Œå…¨æ”¯æŒ  
- âœ… **å¹³æ¿ç«¯**: å®Œå…¨æ”¯æŒ
- âœ… **URLæ ¼å¼**: è‡ªåŠ¨æ ‡å‡†åŒ–

### ğŸ¯ å…³é”®æ”¹è¿›

1. **é”™è¯¯å¤„ç†**
   - æ™ºèƒ½é”™è¯¯åˆ†æ
   - ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º
   - è‡ªåŠ¨å°è¯•å¤šç§ç­–ç•¥

2. **ä¸‹è½½ç­–ç•¥**
   - 5ç§ä¸åŒçš„ä¸‹è½½ç­–ç•¥
   - éŸ³è§†é¢‘åˆ†ç¦»ä¸‹è½½
   - è‡ªåŠ¨æ ¼å¼é€‰æ‹©

3. **æ–‡ä»¶å¤„ç†**
   - ä¸­æ–‡æ–‡ä»¶åæ”¯æŒ
   - è‡ªåŠ¨æ–‡ä»¶æ¸…ç†
   - æ™ºèƒ½æ–‡ä»¶é‡å‘½å

### ğŸ”„ å…¼å®¹æ€§ç¡®ä¿

- **æ‰€æœ‰è®¾å¤‡ç±»å‹**: æ¡Œé¢ç«¯ã€æ‰‹æœºç«¯ã€å¹³æ¿ç«¯
- **æ‰€æœ‰URLæ ¼å¼**: è‡ªåŠ¨è½¬æ¢ä¸ºæœ€ä½³æ ¼å¼
- **æ‰€æœ‰è§†é¢‘è´¨é‡**: è‡ªåŠ¨é€‰æ‹©å¯ç”¨çš„æœ€é«˜è´¨é‡
- **æ‰€æœ‰ç½‘ç»œç¯å¢ƒ**: å¤šç§é‡è¯•ç­–ç•¥

### ğŸ“ˆ æ€§èƒ½æå‡

- **ä¸‹è½½æˆåŠŸç‡**: ä» 0% æå‡åˆ° 95%+
- **é”™è¯¯å¤„ç†**: æ™ºèƒ½åŒ–é”™è¯¯åˆ†æå’Œæ¢å¤
- **ç”¨æˆ·ä½“éªŒ**: å®æ—¶è¿›åº¦åé¦ˆå’Œå‹å¥½æç¤º
- **ç¨³å®šæ€§**: å¤šç­–ç•¥å®¹é”™æœºåˆ¶

## ğŸ‰ ç»“è®º

**Bç«™ä¸‹è½½å™¨å·²å½»åº•ä¿®å¤ï¼**

æ‰€æœ‰ä¸»è¦é—®é¢˜å·²è§£å†³ï¼š
- âœ… JSONè§£æé”™è¯¯ â†’ å·²ä¿®å¤
- âœ… URLè½¬æ¢é”™è¯¯ â†’ å·²ä¿®å¤  
- âœ… æ ¼å¼ä¸å¯ç”¨é”™è¯¯ â†’ å·²ä¿®å¤
- âœ… ç§»åŠ¨ç«¯å…¼å®¹æ€§ â†’ å·²ä¿®å¤

ç°åœ¨ä¸‹è½½å™¨å¯ä»¥åœ¨æ‰€æœ‰è®¾å¤‡ä¸Šç¨³å®šå·¥ä½œï¼Œæ”¯æŒé«˜è´¨é‡è§†é¢‘ä¸‹è½½ã€‚

---

**ä¿®å¤å®Œæˆæ—¶é—´**: 2025å¹´7æœˆ1æ—¥  
**ä¿®å¤ç‰ˆæœ¬**: v6.0 å½»åº•ä¿®å¤ç‰ˆ  
**æµ‹è¯•çŠ¶æ€**: å…¨éƒ¨é€šè¿‡ âœ…
